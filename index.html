<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nombres relatifs ‚Äî R√©visions interactives</title>
  <style>
    :root{
      --bg:#0f172a; --card:#1e293b; --accent:#3b82f6;
      --success:#16a34a; --error:#dc2626; --text:#f1f5f9;
      --choice-bg:#334155; --choice-hover:#475569; --explain:#fde047;
      --radius:12px; --shadow:0 4px 10px rgba(0,0,0,0.6);
    }
    body.light{
      --bg:#f9fafb; --card:#ffffff; --text:#111827;
      --choice-bg:#f1f5f9; --choice-hover:#e2e8f0; --explain:#444;
      --shadow:0 4px 10px rgba(0,0,0,0.1);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji",sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--accent);color:#fff;text-align:center;padding:14px 48px;font-size:1.25rem;font-weight:700;position:relative}
    #toggleTheme{position:absolute;right:12px;top:8px;background:#fff;color:#000;border:none;border-radius:999px;font-size:1.05rem;cursor:pointer;padding:6px 10px}
    #scoreboard{position:absolute;left:12px;top:8px;font-size:.95rem;background:rgba(0,0,0,.25);padding:6px 10px;border-radius:var(--radius)}
    nav{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;padding:12px}
    nav button{padding:8px 14px;border:none;border-radius:var(--radius);cursor:pointer;background:var(--accent);color:#fff;font-size:1rem;box-shadow:var(--shadow)}
    #difficulty{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:4px}
    #difficulty select,#difficulty button{padding:8px 12px;border-radius:10px;border:1px solid transparent;background:var(--card);color:var(--text);box-shadow:var(--shadow)}
    main{display:flex;max-width:1200px;margin:18px auto;gap:20px;padding:0 12px}
    .content{flex:2}
    .calculator{flex:1;background:var(--card);padding:15px;border-radius:var(--radius);box-shadow:var(--shadow);height:fit-content}
    .card{background:var(--card);padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:20px}
    .question{margin-bottom:12px;font-weight:700;font-size:1.1rem}
    .choices button{display:block;width:100%;margin:6px 0;padding:10px;border-radius:var(--radius);border:1px solid #94a3b8;cursor:pointer;background:var(--choice-bg);color:var(--text);font-size:1rem;transition:background .2s}
    .choices button:hover{background:var(--choice-hover)}
    .choices button.correct{background:var(--success)!important;color:#fff}
    .choices button.wrong{background:var(--error)!important;color:#fff}
    .refresh{margin-top:14px;padding:8px 14px;border:none;border-radius:var(--radius);cursor:pointer;background:var(--accent);color:#fff;font-size:1rem;box-shadow:var(--shadow)}
    .explain{margin-top:10px;font-weight:700;color:var(--explain)}
    /* Fractions lisibles (trait √©pais, centr√©, s'adapte au th√®me) */
    .frac{display:inline-grid;grid-template-rows:auto auto;text-align:center;vertical-align:middle}
    .frac .num{border-bottom:2px solid currentColor;padding:0 4px}
    .frac .den{padding:0 4px}
    /* Calculatrice */
    #calcDisplay{width:100%;font-size:1.3rem;padding:10px;margin-bottom:10px;text-align:right;border:1px solid #94a3b8;border-radius:var(--radius);background:var(--bg);color:var(--text)}
    #calcButtons{display:flex;flex-wrap:wrap;gap:6px}
    #calcButtons button{flex:1 0 22%;padding:12px;font-size:1.1rem;border-radius:10px;border:none;cursor:pointer;background:#475569;color:#fff}
    body.light #calcButtons button{background:#e2e8f0;color:#000}
    @media (max-width:980px){main{flex-direction:column}}
  </style>
</head>
<body>
  <header>
    üìò R√©visions ‚Äî Les nombres relatifs
    <span id="scoreboard">Score : 0/0</span>
    <button id="toggleTheme" title="Basculer th√®me">üåô</button>
  </header>

  <div id="difficulty">
    <strong>Difficult√© :</strong>
    <select id="level" onchange="resetScore()">
      <option value="1">Facile</option>
      <option value="2" selected>Moyen</option>
      <option value="3">Difficile</option>
    </select>
    <button onclick="resetScore()">üîÑ R√©initialiser le score</button>
  </div>

  <nav>
    <button onclick="showSection('comparaison')">Comparer</button>
    <button onclick="showSection('valabs')">Valeur absolue & Oppos√©</button>
    <button onclick="showSection('addition')">Addition</button>
    <button onclick="showSection('soustraction')">Soustraction</button>
    <button onclick="showSection('multiplication')">Multiplication</button>
    <button onclick="showSection('division')">Division</button>
  </nav>

  <main>
    <div class="content">
      <!-- Comparaison -->
      <section id="comparaison" class="card">
        <h2>Comparer des nombres relatifs</h2>
        <div class="question" id="compQ"></div>
        <div class="choices" id="compChoices"></div>
        <p id="compExplain" class="explain"></p>
        <button class="refresh" onclick="newComparison()">Nouvel exercice</button>
      </section>

      <!-- Valeur absolue & Oppos√© -->
      <section id="valabs" class="card" style="display:none;">
        <h2>Valeur absolue et oppos√©</h2>
        <div class="question" id="valQ"></div>
        <div class="choices" id="valChoices"></div>
        <p id="valExplain" class="explain"></p>
        <button class="refresh" onclick="newValAbs()">Nouvel exercice</button>
      </section>

      <!-- Addition -->
      <section id="addition" class="card" style="display:none;">
        <h2>Addition de relatifs</h2>
        <div class="question" id="addQ"></div>
        <div class="choices" id="addChoices"></div>
        <p id="addExplain" class="explain"></p>
        <button class="refresh" onclick="newAddition()">Nouvel exercice</button>
      </section>

      <!-- Soustraction -->
      <section id="soustraction" class="card" style="display:none;">
        <h2>Soustraction de relatifs</h2>
        <div class="question" id="subQ"></div>
        <div class="choices" id="subChoices"></div>
        <p id="subExplain" class="explain"></p>
        <button class="refresh" onclick="newSubtraction()">Nouvel exercice</button>
      </section>

      <!-- Multiplication -->
      <section id="multiplication" class="card" style="display:none;">
        <h2>Multiplication de relatifs</h2>
        <div class="question" id="multQ"></div>
        <div class="choices" id="multChoices"></div>
        <p id="multExplain" class="explain"></p>
        <button class="refresh" onclick="newMultiplication()">Nouvel exercice</button>
      </section>

      <!-- Division -->
      <section id="division" class="card" style="display:none;">
        <h2>Division de relatifs</h2>
        <div class="question" id="divQ"></div>
        <div class="choices" id="divChoices"></div>
        <p id="divExplain" class="explain"></p>
        <button class="refresh" onclick="newDivision()">Nouvel exercice</button>
      </section>
    </div>

    <!-- Calculatrice -->
    <div class="calculator">
      <h2>üßÆ Calculatrice</h2>
      <input type="text" id="calcDisplay" disabled />
      <div id="calcButtons"></div>
    </div>
  </main>

  <script>
    // Th√®me
    document.getElementById('toggleTheme').onclick=()=>{
      document.body.classList.toggle('light');
      document.getElementById('toggleTheme').textContent=document.body.classList.contains('light')?'‚òÄÔ∏è':'üåô';
    };

    // Score
    let score=0,total=0;
    function updateScore(){ document.getElementById('scoreboard').textContent=`Score : ${score}/${total}`; }
    function resetScore(){ score=0; total=0; updateScore(); }

    // Niveau
    function getLevel(){ return +document.getElementById('level').value; }

    // Outils nombres
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function typePoolByLevel(level){
      if(level===1) return ['int'];
      if(level===2) return ['int','dec'];
      return ['int','dec','frac']; // niveau 3
    }
    function renderNumber(n){
      if(typeof n==='object' && n.frac){
        return `<span class="frac"><span class="num">${n.num}</span><span class="den">${n.den}</span></span>`;
      }
      return n<0?`(${n})`:`${n}`;
    }
    function formatNumber(type){
      if(type==='int'){ return renderNumber(randInt(-20,20)); }
      if(type==='dec'){ return renderNumber(Math.round((Math.random()*20-10)*10)/10); }
      if(type==='frac'){
        let num=randInt(-9,9); if(num===0) num=1;
        let den=[2,4,5,10][randInt(0,3)];
        return renderNumber({frac:true,num,den});
      }
    }
    function evalFrac(str){
      if(str.includes('frac')){
        const num=parseFloat(str.match(/<span class="num">(.*?)<\/span>/)[1]);
        const den=parseFloat(str.match(/<span class="den">(.*?)<\/span>/)[1]);
        return num/den;
      }
      return parseFloat(str.replace(/[()]/g,''));
    }

    // QCM
    function makeChoices(container, correct, wrongs, explainId, explanation){
      container.innerHTML=''; document.getElementById(explainId).textContent='';
      const answers=[correct,...wrongs].sort(()=>Math.random()-0.5);
      answers.forEach(ans=>{
        const btn=document.createElement('button'); btn.innerHTML=ans;
        btn.onclick=()=>{
          container.querySelectorAll('button').forEach(b=>b.disabled=true);
          total++;
          if(ans===correct){ score++; btn.classList.add('correct'); }
          else{ btn.classList.add('wrong'); document.getElementById(explainId).textContent='‚ùå '+explanation; }
          updateScore();
        };
        container.appendChild(btn);
      });
    }

    // Modules
    function newComparison(){
      const pool=typePoolByLevel(getLevel());
      const t=pool[randInt(0,pool.length-1)];
      let a=formatNumber(t), b=formatNumber(t);
      while(evalFrac(a)===evalFrac(b)) b=formatNumber(t);
      const correct=evalFrac(a)>evalFrac(b)?a:b;
      document.getElementById('compQ').innerHTML=`Quel est le plus grand entre ${a} et ${b} ?`;
      const exp=`On compare ${evalFrac(a)} et ${evalFrac(b)} : ${correct} est plus grand car sa valeur est la plus √©lev√©e.`;
      makeChoices(document.getElementById('compChoices'),correct,[a,b].filter(x=>x!==correct),'compExplain',exp);
    }

    function newValAbs(){
      const pool=typePoolByLevel(getLevel());
      const t=pool[randInt(0,pool.length-1)];
      const n=formatNumber(t);
      if(Math.random()<0.5){
        document.getElementById('valQ').innerHTML=`Valeur absolue de ${n} ?`;
        const c=Math.abs(evalFrac(n)).toString();
        const exp=`La valeur absolue est la distance √† 0 : |${evalFrac(n)}| = ${c}.`;
        makeChoices(document.getElementById('valChoices'),c,[ (evalFrac(n)+1).toString(),(evalFrac(n)-1).toString() ],'valExplain',exp);
      }else{
        document.getElementById('valQ').innerHTML=`Oppos√© de ${n} ?`;
        const c=(-evalFrac(n)).toString();
        const exp=`L‚Äôoppos√© de ${evalFrac(n)} est ${c} car leur somme vaut 0.`;
        makeChoices(document.getElementById('valChoices'),c,[ (evalFrac(n)+2).toString(),(evalFrac(n)-2).toString() ],'valExplain',exp);
      }
    }

    function newAddition(){
      const lvl=getLevel(); const pool=typePoolByLevel(lvl);
      const n = (lvl===1)?2 : (lvl===2?randInt(3,4):randInt(4,5));
      const terms=Array.from({length:n},()=>formatNumber(pool[randInt(0,pool.length-1)]));
      const res=terms.map(evalFrac).reduce((a,b)=>a+b,0).toFixed(2);
      document.getElementById('addQ').innerHTML=`Calcule : ${terms.join(' + ')}`;
      const exp=`On additionne terme √† terme : ${terms.map(evalFrac).join(' + ')} = ${res}.`;
      makeChoices(document.getElementById('addChoices'),res,[ (res*1+1).toFixed(2),(res*1-1).toFixed(2) ],'addExplain',exp);
    }

    function newSubtraction(){
      const lvl=getLevel(); const pool=typePoolByLevel(lvl);
      const n = (lvl===1)?2 : (lvl===2?randInt(3,4):randInt(4,5));
      const terms=Array.from({length:n},()=>formatNumber(pool[randInt(0,pool.length-1)]));
      let val=evalFrac(terms[0]); for(let i=1;i<terms.length;i++){ val-=evalFrac(terms[i]); }
      const res=val.toFixed(2);
      document.getElementById('subQ').innerHTML=`Calcule : ${terms.join(' - ')}`;
      const exp=`Soustraire = ajouter l‚Äôoppos√© : ${terms[0]} - ${terms[1]} = ${evalFrac(terms[0])} + (${ -evalFrac(terms[1]) }) ‚Üí r√©sultat final ${res}.`;
      makeChoices(document.getElementById('subChoices'),res,[ (res*1+1).toFixed(2),(res*1-1).toFixed(2) ],'subExplain',exp);
    }

    function newMultiplication(){
      const lvl=getLevel(); const pool=typePoolByLevel(lvl);
      const n = (lvl===1)?2:randInt(2,3);
      const terms=Array.from({length:n},()=>formatNumber(pool[randInt(0,pool.length-1)]));
      const res=terms.map(evalFrac).reduce((a,b)=>a*b,1).toFixed(2);
      const negs=terms.filter(t=>evalFrac(t)<0).length;
      document.getElementById('multQ').innerHTML=`Calcule : ${terms.join(' √ó ')}`;
      const exp=`R√®gle du signe : ${negs} n√©gatif(s) ‚Üí produit ${negs%2===0?'positif':'n√©gatif'}. Calcul : ${terms.map(evalFrac).join(' √ó ')} = ${res}.`;
      makeChoices(document.getElementById('multChoices'),res,[ (res*1+1).toFixed(2),(res*1-1).toFixed(2) ],'multExplain',exp);
    }

    function newDivision(){
      const lvl=getLevel(); const pool=typePoolByLevel(lvl);
      const a=formatNumber(pool[randInt(0,pool.length-1)]);
      let b=formatNumber(pool[randInt(0,pool.length-1)]);
      while(evalFrac(b)===0){ b=formatNumber('int'); } // √©viter division par 0
      const quot=(evalFrac(a)/evalFrac(b));
      const res=Number.isFinite(quot)?quot.toFixed(2):'NaN';
      const samesign = (evalFrac(a)>=0 && evalFrac(b)>=0) || (evalFrac(a)<0 && evalFrac(b)<0);
      document.getElementById('divQ').innerHTML=`Calcule : ${a} √∑ ${b}`;
      const exp=`R√®gle du signe : ${samesign?'signes identiques ‚Üí quotient positif':'signes contraires ‚Üí quotient n√©gatif'}. Calcul : ${evalFrac(a)} √∑ ${evalFrac(b)} = ${res}.`;
      makeChoices(document.getElementById('divChoices'),res,[ (res*1+1).toFixed(2),(res*1-1).toFixed(2) ],'divExplain',exp);
    }

    // Calculatrice
    (function createCalculator(){
      const keys=["7","8","9","/","4","5","6","*","1","2","3","-","0",".","=","+","(",")","C"];
      const cont=document.getElementById('calcButtons');
      keys.forEach(k=>{
        const b=document.createElement('button'); b.textContent=k;
        b.onclick=()=>{
          const d=document.getElementById('calcDisplay');
          if(k==="C") d.value="";
          else if(k==="="){ try{ d.value=eval(d.value); }catch{ d.value="Erreur"; } }
          else d.value+=k;
        };
        cont.appendChild(b);
      });
    })();

    // Init
    window.onload=()=>{
      resetScore();
      newComparison(); newValAbs(); newAddition(); newSubtraction(); newMultiplication(); newDivision();
      showSection('comparaison');
    };

    // Navigation
    function showSection(id){
      document.querySelectorAll('section').forEach(s=>s.style.display='none');
      document.getElementById(id).style.display='block';
    }
  </script>
</body>
</html>
